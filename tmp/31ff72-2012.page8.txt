                            where es = Concatenate(v1,v2). The expression es concate-                                                                            edges of the dag consist of more sophisticated (substrings
                            nates the two input string variables v1 and v2, which is then                                                                        of) lookup expressions, whose predicates can in-turn be rep-
                            used to perform the lookup in the BikePrices table.                                                                                  resented using nested-dags.
                                 Example 6. Concatenating table outputs: A user                                                                                       Consider Example6, wheretheinputstringis“c4 c3 c1”
                            had a series of three company codes in a column and wanted                                                                           and the output string is “Facebook Apple Microsoft” (of
                            to expand them into the corresponding series of company                                                                              length 24). The dag G that represents the set of all transfor-
                            names using a table Comp that mapped company codes to the                                                                            mations consistent with this input-output pair is shown in
                            company names as shown in Figure 7.                                                                                                  Figure 8. For better readability, we only show some of the
                                                                                                                                                                 relevant nodes and edges of the dag G. The edge from node
                                                                                                                                                                 0 to node 8 corresponds to all expressions e˜ that generate
                                                                                                                           Comp                                                                                                                            1
                                                                                                                   Id         Name                               the string Facebook. One of the lookup transformations,
                                                                                                                                                                                                                     ˜
                               Input v               Output                                                                                                      Select(Name,Comp,Id = f ), in e˜ requires syntactic trans-
                                             1                                                                     c1         Microsoft                                                                               1              1
                                                                                                                                                                                         ˜
                               c4 c3 c1              Facebook Apple Microsoft                                      c2         Google                             formations f1 to extract substring c1 from the input string,
                               c2 c5 c6              Google IBM Xerox                                              c3         Apple                                             ˜
                                                                                                                                                                 where f1 is itself represented as a nested-dag as shown in
                               c1 c5 c4              Microsoft IBM Facebook                                        c4         Facebook                           the ﬁgure. The edges for expressions e˜ and e˜ also consist
                               c2 c3 c4              Google Apple Facebook                                         c5         IBM                                                                                                               3              5
                                                                                                                   c6         Xerox                              of similar nested-dags.
                                                                                                                   · · ·      · · ·                                   Theorem 3                      (Properties of data structure D ).
                                                                                                                                                                                                                                                                                   u
                                                                                                                                                                 (a) The number of transformations in L that are consistent
                            Figure 7: A nested syntactic and lookup transfor-                                                                                                                                                                    u
                            mation. It requires concatenating results of multi-                                                                                  with a given input-output example may be exponential in the
                            ple lookup transformations, each of which involves a                                                                                 number of reachable entries, the number of columns in a pri-
                            selection operation that indexes on some substring                                                                                   mary key, and the length of the largest reachable string.
                            of the input.                                                                                                                        (b) However, the data structure Du can represent these po-
                                                                                                                                                                 tentially exponential number of transformations in size poly-
                                This transformation is expressed in L as:                                                                                        nomial in the number of reachable entries, the number of
                                                                                                             u                                                   primary keys, the number of columns in a primary key, and
                            Concatenate(f1,ConstStr(“ ”),f2,ConstStr(“ ”),f3), where                                                                             the length of the largest reachable string.
                            f    ≡Select(Name,Comp,Id = SubStr2(v ,AlphTok,1)), f ≡
                             1                                                                               1                                2
                            Select(Name,Comp,Id = SubStr2(v1,AlphTok,2)) and f3 ≡                                                                                (a) Proof of (a) follows from Theorem 1(a). The number
                            Select(Name,Comp,Id = SubStr2(v1,AlphTok,3)). The ex-                                                                                of transformations can also be exponential in the length of
                            pressions f , f , and f                         extract the ﬁrst, second, and third                                                  the largest reachable string as we are using GenerateStr
                                                 1      2               3                                                                                                                                                                                                               s
                            words from the input string respectively, which are then                                                                             procedure for checking reachability which has this worst case
                            used for performing the table lookups and the results are                                                                            complexity. (b) We show that the size of the data structure
                                                                                                                                                                                                  2              2
                            concatenated with whitespaces to obtain the output string.                                                                           generated is O(t p m ` ) in Theorem 4(a).
                            5.2          DataStructureforSetofExpressionsinL                                                                                     5.3           Synthesis Algorithm for Lu
                                                                                                                                                  u
                                         ˜              ˜
                                LetRt andRs denotethesetofgrammarrulesforthedata                                                                                 Procedure GenerateStr
                            structures that represent set of expressions in languages L                                                                                                                             u
                                                                                                                                                   t             Recall that the GenerateStr procedure for language L
                                                                                                                           ˜                                                                                                  t                                                         t
                            and Ls respectively (See [8] for description of Rs). We con-                                                                         (§4.3) performs reachability on table entries based on ex-
                            struct the grammar rules for the data structure that rep-                                                                            act string matches (T[C,r] = η). The key idea in case of the
                            resents set of expressions in the extended language L                                                               by
                                                                                                                                           u                     language L is to perform a more relaxed reachability on ta-
                                                                                                     ˜          ˜                                                                      u
                            taking the union of the two rules Rt ∪ Rs and modifying                                                                              ble entries taking into account the possibility of performing
                            some rules as follows:                                                                                                               syntactic manipulations on previously reachable strings.
                                 ˜                                                                                                                                                                                                 0
                                f          :=        ConstStr(s) | ˜e | SubStr(˜e ,˜p                                   , ˜p    )                                     Weﬁrst deﬁne a GenerateStr procedure by making two
                                   s                                                 t                       t      s       s                                                                                                      t
                                                                                                                     1        2                                  modiﬁcations to the GenerateStr procedure.                                                            First, we
                                 p˜        :=        C=s|C=˜e                                                                                                                                                                           t
                                   t                                              s                                                                              replace the condition “T[C,r] = val(η)” in GenerateStr
                                                                      s      t                                                               f                                                                                                                                          t
                                                                                  ˜               ˜                              ˜            s
                                 e˜        :=        Dag(α˜,α ,α ,ξ,W) | f , where W : ξ → 2
                                   s                                                               s                                                             (Line 9 in Figure 5(a)) by the condition “GenerateStr (σ∪
                                                                                                                                                                                                                                                                               s
                                The most interesting aspect of this data structure is the                                                                        η˜, T[C,r]) contains any expression that uses a variable from
                                             s      t ˜                                                                                                          σ∪η˜”. We use the notation σ∪η˜ to denote a state that ex-
                            Dag(α˜,α ,α ,ξ,W) construct, which succinctly represents a                                                                                                                                                                                                    0
                                                                                                                                                                 tendsσandmapsηtoval(η)forallη ∈ η˜. TheGenerateStr
                            set of Concatenate expressions in Lu using a dag (directed                                                                                                                                                                                                    t
                            acyclic graph), where α˜ is a set of nodes containing two                                                                            procedure marks a table entry as reachable if it can be com-
                                                                                                                                                                 puted using the GenerateStr procedure (from [8]) on pre-
                                                                                                     s                t     ˜                                                                                                s
                            distinct source and target nodes α and α , ξ is a set of                                                                             viously reachable strings. The GenerateStr procedure can
                            edges over nodes in α˜ that induces a dag, and W maps each                                                                                                                                                                    s
                                             ˜                                                                                                                   perform concatenation of constant strings and substrings of
                            edge in ξ to a set of atomic expressions. The semantics [[.]]                                                                        previously reachable strings (η˜). We add an additional check
                            of the Dag constructor is:                                                                                                           that the expressions synthesized by GenerateStr contains
                                                                                                                                                                                                                                                                      s
                                               s      t ˜                                                                                                        a variable from σ ∪ η˜ to avoid expressions containing only
                            [[Dag(α˜,α ,α ,ξ,W)]] = {Concatenate(f ,...,f                                                        ) |
                                                                                                             s              sn
                                                                                                              1                                                  constant string expressions. For our experiments, we en-
                                                  ˜                             ˜                                                 s               t
                              f     ∈[[W(ξ )]],ξ ,..,ξ ∈ ξ form a path between α and α }
                               si                  i        1          n                                                                                         force an even stronger restriction that there exists a string
                            The set of all Concatenate expressions represented by the                                                                            η ∈ (σ ∪ η˜) such that either T[C,r] is substring of η or η
                            Dag constructor includes exactly those whose ordered argu-                                                                           is a substring of T[C,r]. This provides eﬃciency without
                            ments belong to the corresponding edges on any path from                                                                             any practical loss of precision. The second modiﬁcation is
                            αs to αt. This dag representation is similar to the represen-                                                                        in Line 10 in Figure 5(a), where we replace the generalized
                            tation of string expressions in [8]. However, in our case, the                                                                       predicate with C0 = {GenerateStr (σ ∪η˜,T[C0,r])}.
                                                                                                                                                                                                                                        s
                                                                                                                                                        747
