                                                           a) Error distribution                      b) SA− depth-wise comparison                      c) SA+ depth-wise comparison
                                                                                                  1                                                 1
                                              120         SA+                                                                                                                    4
                                                          SA−                                   0.8                                               0.8
                                             d100
                                             a
                                             e 80
                                             h                                                  0.6                                               0.6
                                                                                               cy                                                cy
                                             o                                                                                                                              
                                             t                                                 ra                                                ra                            2
                                               60                                                               4
                                             ce                                                ccu0.4                                            ccu0.4
                                             n                                                 a                                                 a
                                             a 40
                                             st                                                           
                                             i                                                              2
                                             d 20                                               0.2                                               0.2
                                                0                                                 0                                                 0
                                                      25       50      75     100     125           10         15         20        25                10         15        20         25
                                                              failure position                                      depth                                             depth
                                                                                                                                 +              −
                            Figure 3: In a, we plot the distribution of the errors made by SA                                       and SA , based on the position of the mispre-
                            dicted symbol, and its distance to its head. In b and c, we plot the performance of the models as depth increases.
                            ferently, these results suggest LSTMhasastrongin-                                          are mostly concentrated at f                          >80. Figure 3b-
                                                                                                                                                                         p
                            ductive bias, perhaps in counting (Kharitonov and                                          c shows how the performance of SA+ and SA−
                            Chaabouni, 2020), which might result in degrada-                                           change with depth (d ) for D and D languages.
                                                                                                                                                            p             2            4
                                                                                                                             −
                            tion of its performance in higher Dyck languages.                                          SA isverysensitive to depth as the accuracy de-
                                                                                                                       creases rapidly for D from ∼38% at d = 10 to a
                                                                                                                                                          2                              p
                              Algorithm1:Compatibilityofanattention                                                    complete failure beyond d = 20. In comparison,
                                                                                                                                                                    p
                              mapwithastack-based recognizer.                                                          the drop in accuracy for SA+ is less severe, ∼ 94%
                                 import numpy as np                                                                    at d = 10 to ∼ 72% at d = 20.
                                                                                                                              p                                   p
                                 def get_match(seq, opening='(['):
                                   stack, match = [], len(seq)*[-1]                                                    4      Compatibility With a Stack-Based
                                   for idx, s in enumerate(seq):                                                              Recognizer
                                     if s in opening:
                                       stack.insert(0, idx)
                                     elif s != 'T':                                                                    Theability of (memory-less) SA networks to recog-
                                       stack.pop(0)                                                                    nize D             languages is intriguing. In this section,
                                       if len(stack) > 0:                                                                          n>1
                                         match[idx] = stack[0]                                                         wecontrast second-layer attention maps produced
                                   return match                                                                                    +                −
                                                                                                                       by SA and SA , and provide insights into the
                                 def is_compatible(seq, atten_map):                                                    underlying mechanism which leads to the success
                                   match = get_match(seq)                                                                        +
                                   for idx, m in enumerate(match):                                                     of SA .
                                     p = np.argmax(atten_map[idx])                                                         Wedeﬁne compatibility as a quantitative mea-
                                     if m != p and m != -1:                                                            sure for the alignment of the state of a stack-based
                                       return False                                                                    language recognizer (M) with the attention maps.
                                   returnTrue
                                                                                                                       Mhasaccess to the top of a hypothetical stack,
                                                                                                                       and can push and pop depending on the opening
                            3.2       Error Analysis                                                                   and closing brackets, respectively. Based on this
                            Wedeﬁne failure position (f ) as the position of                                           analogy, all opening brackets should attend to them-
                                                                              p
                            the ﬁrst symbol in the sequence where the model                                            selves, and all closing brackets should ﬁrst do a pop,
                            failed to correctly predict the next set of possible                                       and then attend to the last unmatched bracket. For
                            parentheses, For each symbol in a Dn sequence: (i)                                         example, the symbol “]” in the string “([])”, will
                            depth (d ) is the number of unmatched parenthesis                                          ﬁrst pop “[” from the stack, then it attends to “(”,
                                          p
                            uptoandincluding that symbol, and (ii) distance                                            the last unmatched symbol, which will determine
                            to head (d ) is the number of symbols between the                                          the next valid closing bracket. If for every closing
                                             h
                            mis-classiﬁed closing bracket and its opening coun-                                        symbol in the sequence, the highest attention score
                            terpart. Figure 3a plots the error distribution of                                         of at least one of the heads points to the correct
                            SA+andSA−intermsoffailureposition (f ) and                                                 bracket, then we consider the SA compatible. Fur-
                                                                                                      p
                                                                                                                                                                                                  +
                            distance to head (d ). There is a clear separation                                         thermore, for a fair comparison between SA                                     and
                                                             h
                                                                                                                             −
                            between the two models in terms of what “types”                                            SA , we do not push the starting symbol to the
                            of errors are made. SA− breaks quite early on in                                           stack and only consider closing brackets which are
                            the sequence, with majority of the errors occurring                                        not at the end of a clause.
                                                                                                               +                                                                         +               −
                            at f = 25-75 whereas whereas the errors of SA                                                  Figure5plotsthecompatibilityofSA andSA
                                   p
                                                                                                                4304
