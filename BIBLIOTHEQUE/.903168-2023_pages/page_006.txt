                    50                                                                                                           whenthe number of boxes increases from 300 to 4000. On
                              DETR                           45.8       46.3           46.7          46.8            46.8
                              DiffusionDet                                                                                       the contrary, cloning more queries for DETR (N                                         >300)
                    45                                                                                                                                                                                          eval
                                     41.9                                                                                        causes a slight decrease in DETR performance from 38.8
                                                                                 Clone
                    40                                       38.8       38.4           38.4           38.4           38.4        to 38.4 AP, which is then held constant when using more
                                     34.9                                36.5                                                    queries.
                    35 33.0                                                            34.0
                       31.0                                             Concat Random                 30.2                            We also implement another method for DETR when
                    30                                                                                                           N           >N ,concatenating extra N                                      −N               ran-
                                                                                                                     26.4            eval            train                                          eval            train
                                     N    >N
                                      train  eval                                    N    <N
                    25                                                                train  eval                                domly initialized queries (a.k.a. concat random). With
                      50            100                     300        500            1000           2000           4000         this strategy, DETR has a clear performance drop when
                                                        number of boxes (log-scale)
                                                                                                                                 the N             is different from N                       .   Besides, this perfor-
                     (a) Dynamic number boxes. Both DETR and DiffusionDet are trained                                                      eval                                      train
                     with 300 object queries or proposal boxes. More proposal boxes in in-                                       mance drop becomes larger when the difference between
                     ference bring accuracy improvement on DiffusionDet, while degenerate                                        N          and N               increases. For example, when the num-
                     DETR.                                                                                                           eval              train
                                                                                                                                 ber of boxes increases to 4000, DETR only has 26.4 AP
                                                                                                                                 with concat random strategy, which is 12.4 lower than
                    47              46.8         46.8         46.8         46.9         46.9          46.9         46.8          the peak value (i.e., 38.8 AP with 300 queries).
                       46.3                      46.6         46.6         46.8         46.8          46.8         46.8
                                    46.5                                                              46.2                       Iterative evaluation.                   We further investigate the perfor-
                       45.8                                   45.8         45.8         46.0                       46.1          mance of our proposed approach by increasing the num-
                    45                           45.2                                                                            ber of iterative steps from 1 to 8, and the corresponding re-
                                    44.5                                                                                         sults are illustrated in Figure 3b. Our findings indicate that
                    43                                                                                                           the DiffusionDet models employing 100, 300, and 500 ran-
                                                                                                    DiffusionDet: S@500          domboxesexhibitconsistentperformanceimprovementsas
                       41.9                                                                         DiffusionDet: S@300
                                                                                                    DiffusionDet: S@100          the number of iterations increases. Moreover, we observe
                    411             2            3            4            5            6            7            8              that DiffusionDet with fewer randomboxestendstoachieve
                                                         number of iteration steps S                                             more substantial gains with refinement. For instance, the
                     (b) Iterative evaluation. ‘S@500’ denotes that we evaluate DiffusionDet                                     AP of DiffusionDet instance utilizing 100 random boxes
                     with 500 boxes using a different number of iteration steps.. For all cases,                                 improves from 41.9 (1 step) to 46.1 (8 steps), representing
                     the accuracy increases with refinement times.
                                                                                                                                 an absolute improvement of 4.2 AP.
                     Figure 3. Flexibility of DiffusionDet. All experiments are trained                                          Zero-shot transferring. To further validate the effective-
                     onCOCO2017trainsetandevaluatedonCOCO2017valset.                                                             ness of generalization, we conduct an evaluation of COCO-
                     DiffusionDet uses the same network parameters for all settings in                                           pretrained models on the CrowdHuman dataset, without
                     Figure 3a and 3b. Our proposed DiffusionDet is able to benefit                                              any additional fine-tuning.                      Specifically, our focus is on
                     from more proposal boxes and iteration steps using the same net-
                     workparameters.                                                                                             the [person] class for the final average precision (AP)
                                                                                                                                 performance. The experimental results are presented in Ta-
                                                                                                                                 ble 1. Our observations indicate that when transferring to a
                     with DETR [10] to show the advantage of dynamic boxes.                                                      newdataset with scenarios that are more densely populated
                     Comparisons with other detectors are in Appendix B. We                                                      than COCO, our proposed method, namely DiffusionDet,
                     reproduce DETR [10] with 300 object queries using the of-                                                   demonstrates a notable advantage by increasing the number
                     ficial code and default settings for 300 epochs of training.                                                of evaluation boxes or iteration steps. For instance, by in-
                     WetrainDiffusionDet with 300 random boxes such that the                                                     creasing the number of boxes from 300 to 2000 and the iter-
                     number of candidates is consistent with DETR for a fair                                                     ation steps from 1 to 4, DiffusionDet achieves a significant
                     comparison. The evaluation is on {50, 100, 300, 500, 1000,                                                  APgain of 5.3 and 4.8, respectively. In contrast, previous
                     2000, 4000} queries or boxes.                                                                               methods exhibit limited gain or serious performance degra-
                          Since the learnable queries are fixed after training in the                                            dation, with a decrease of 14.0 AP. The impressive flexi-
                     original setting of DETR, we propose a simple workaround                                                    bility of DiffusionDet implies that it is an invaluable asset
                     to enable DETR work with a different number of queries:                                                     for object detection tasks across a wide range of scenarios,
                     when N                 < N             , we directly choose N                          queries              including sparsely populated and densely crowded environ-
                                   eval             train                                           eval
                     from N                queries; when N                      >N ,wecloneex-                                   ments, without any additional fine-tuning requirements.
                                  train                                 eval            train
                     isting N                 queries up to N                     (a.k.a.       clone). We
                                    train                                 eval                                                   4.3. Benchmarking on Detection Datasets
                     equip DETR with NMS because cloned queries will pro-
                     duce similar detection results as the original queries. As                                                       In Table 2, we present a comparison of our DiffusionDet
                     shown in Figure 3a, the performance of DiffusionDet in-                                                     with several state-of-the-art detectors [7,10,56,74,90,114]
                     creases steadily with the number of boxes used for evalu-                                                   ontheCOCOdataset. Formorecomprehensiveexperimen-
                     ation. For example, DiffusionDet can achieve 1.0 AP gain                                                    tal settings, please refer to the Appendix. Notably, our Dif-
                                                                                                                           19835
