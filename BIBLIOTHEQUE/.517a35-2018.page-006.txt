              PLDI’18, June 18–22, 2018, Philadelphia, PA, USA                     WoosukLee,KihongHeo,RajeevAlur,andMayurNaik
              3.3.1  Notations                                                 Algorithm2WeightedEnumerativeSearch
                                                                                Functionweighted_search (Gq,pts,Φ,д)
              Aweighteddirected graph consists of a set of vertices and a                                  e
              set of edges with real-valued weights. An edge fromp toq                // д is a heuristic function described in Section 3.3.3.
                                         X              Y                        1: Q := {(S,0,д(S))}
              withalabelX isdenotedp →q.Apathp ⇝q isasequence                    2: whileQ is not empty do
              of vertices and edges leading from p to q with a sequence          3:   remove(n,c ,cд) whosec +cд is minimal fromQ.
              Y of labels on the edges. Each edge has the associated cost.                       f           f
                                                                                             ∗                J K
              Letters A,B denote non-terminal symbols, lettersa,b denote         4:   if n ∈ Σ ∧∀x ∈ pts. Φ(x, n (x)) then
              terminal symbols, and letters α,β denote sentential forms.         5:     return n
                                                                                 6:   endif         r
              Ourweightedenumerativealgorithmoperatesonaweighted                 7:   for all n′ s.t. n → n′ do
                                                                                                ′          r  ′     ′
              directed graph of sentential forms defined as follows:             8:     insert (n ,cf +w(n → n ),д(n )) intoQ
              Definition3.1(DerivationGraphofSententialForms). Given             9:   endfor
                                                                                10:   for all ⟨(n,cf ,cд),(n′,c′,c′)⟩ ∈ Q ×Q do
              a statistical program model G    = ⟨G,C,p,q⟩ where G =                                        f  д
                                             q                                  11:     if n ≈pts n′ ∧cf +cд > c′ +c′ then
              ⟨N,Σ,S,R⟩, a graph G(Gq) is a weighted directed labeled                                          f    д
                                                 ∗                              12:        remove(n,cf ,cд) fromQ
              graph ⟨N,E⟩ where N ⊆ (N ∪ Σ) , E ⊆ N × N ×R, and                 13:     endif
                         +
              w : E → R ∪{∞}definedasfollows:                                   14:   endfor
                              A→β                        ∗              ∗       15: end while
                    E = {αAγ −→ αβγ | A → β ∈ R,α ∈ Σ ,β,γ ∈ (N ∪ Σ) }
                    A→β         −log2q(A → β | p(n1))   (q(A → β | p(n1)) , 0)
               w(n1 −→ n2) =     ∞                       (otherwise)           search. The neighborhoodsofn areexpandedandaddedinto
              ThegraphhasastartnodeS and(possibly) infinitely many             the queue and the distances are updated (lines 7-9). As an
              goal nodes, which are all the programs in P.                     optimization that will be described in Section 3.4, we remove
                                                                               redundant sentential forms from the queue by applying the
              3.3.2  A*basedSearch                                             notion of equivalence classes of sentential forms to abstract
              WeuseA*search[14]overthederivationgraphofsentential              the search space (lines 10-14).
              forms. A* is a best-first graph search algorithm. It expands        In the rest of this section, we explain how to obtain the
              nodesthatappeartoleadtothenextclosestgoalnode.Itiden-            functionдandhowtoapplythenotionofequivalenceclasses.
              tifies such nodes n by using not only their (known) distance     3.3.3   Heuristic Function
              f (n) fromthestartnodebutalsoanestimateд(n)oftheir(un-           Ideally, we can achieve the best performance (in terms of
              known)distancetotheclosestgoalnode.Using f (n)+д(n)as            expanded nodes) if we use the exact distanceд∗(n) for each
              theestimatedleastdistancefromthestartnodetotheclosest                                                            r
              goal node fromn, the algorithm repeatedly chooses the next       node n, formally: д∗(n) = min       ∗  r  w(n ⇝ s) where
              noden′ whose f(n′)+д(n′) is minimum. It always finds the                r                         s∈Σ ,n⇝s
              shortest path from the start node to a goal node when such       w(n ⇝ s) is the sum of the weights associated with the
                                                                                                     r
              a path exists if д(n) never overestimates the actual distance    edges on the path n ⇝ s. However, it is infeasible to com-
              д∗(n) to the closest goal node, i.e.,д(n) ≤ д∗(n). The function  puteд∗(n) because there are possibly infinitely many goal
              д is called the heuristic function.                              nodes reachable fromn and we cannot evaluate all of them.
                Algorithm 2 depicts our algorithm. Not only the inputs         Instead, we use an underapproximationд ofд∗. Intuitively,
              required by the abstract procedure weighted_search, but          wecomputeguessedfuturedistances without considering
              also a heuristic function д is provided as input to the algo-    contextsthatwillconditionfutureproductions.Thefunction
              rithm. For a given statistical program model, the heuristic      д is defined as:
              function can be automatically derived once and for all, and it                     (    Í 0            (n ∈ Σ∗)
              is used throughout the search. How to derive such a function                 д(n) =   −    log h(ni)  (otherwise)
              will be described in the following Section 3.3.3. Also, note                          n ∈N   2
                                                                                                     i
              that the derivation graph of sentential forms is not explicitly  where n refers to the i-th symbol in the sentential form
              constructed and then traversed, but built on the fly.                     i
                Wedetail the algorithm next. The priority queue main-          n. If a given node is a sentence, then д returns 0 because
              tainedthroughoutthesearchisinitializedatline1.Thequeue           wehavealready reached a goal node. Otherwise, for each
              contains triples of a sentential form n, the shortest distance   non-terminal symbol inn, we compute a guessed distance
              from the start node to n, and a guessed distance from n to       to the closest goal node reachable from n using a function
              the closest goal node. At every iteration of the loop, most      h, and then we sum up the computed values. For a non-
              promising sentential formn is picked from the queue (line        terminal symbol A ∈ N, h(A) refers to an upper bound of
              3). If n is a correct sentence (i.e., a program) with respect    the probabilities of expressions that can be derived from A.
              to pts, it is returned (lines 4-5). Otherwise, we continue the   For all A ∈ N, h(A) should satisfy the following:
