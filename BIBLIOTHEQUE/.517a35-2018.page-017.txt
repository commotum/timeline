                      Accelerating Program Synthesis using Learned Probabilistic Models                                                      PLDI’18, June 18–22, 2018, Philadelphia, PA, USA
                      Lemma A.4. n ≈                       n      =⇒ ∀v ∈ pts. T(n [v/x]) =
                                               i     pts     j                                      i                        Proof. The graph G(G ) is a tree due to the unambiguity of
                     T(nj[v/x]).                                                                                                                                q
                                                                                                                             the grammar as stated in Section 3. Every node in a tree can
                      Proof. We prove the theorem by induction on the number                                                 be visited only once during A* search.                                                      ■
                      of reducible programs P in the sentential forms n′ (denoted
                           ′                             ′                           ′              i                        LemmaA.8. Suppose G(G ) is finite in Algo. 2. If a node
                     p(ni)). Let ni[v/x] = ni and nj[v/x] = nj.                                                                                                          q
                                      ′                                                     ′       ′                        n ∈ N is reachable from S, then n′ such that n ≈                                       n′ is
                      Basis (p(n ) = 0): By the definition of ≈                         , n   =n . Because                                                                                                    pts
                                      i                                             pts     i       j                        placed into the queue after a finite number of iterations.
                      ∀v.T(n′) = n′,T(n′) = n′, ∀v ∈ pts.T(n′) =T(n′).
                                  i        i        j ′      j                        i            j
                      Inductivecase(p(ni) = k+1):Wehavethefollowinginduc-                                                    Proof. First we show that n is placed into the queue after a
                      tion hypothesis: for all sentential formni such thatp(ni) = k,                                         finite number of iterations ignoring lines 10–14 by contradic-
                      n ≈         n =⇒ ∀v ∈ pts.T(n [v/x]) =T(n [v/x]). By the
                        i    pts    j                                 i                     j                                tion. Let n be a node reachable from S but never placed into
                      definition of ≈             , there exist reducible programs P < n′
                                              pts                                                        i        i          the queue. Since n is reachable from S and the grammar is
                                         ′                                     J    K            J    K                                                                                                         ′
                      and Pj < nj such that ∀v ∈ pts. Pi (v) = Pj (v) and                                                    unambiguous,thereexistsauniquepathS ⇝n.Letn bethe
                      n′[P /ϵ] ≈           n′[P /ϵ].Bytheinductionhypothesisand∀v ∈
                        i   i         pts    j    j                                                                          first nodeinthepaththatisneveraddedintothequeue.Then
                              J    K             J    K                                  ′       J    K                                                               ′′                   ′′         ′                  ′′
                      pts.      Pi (v) = Pj (v)), ∀v ∈ pts. T(ni[Pi/ Pi (v)]) =                                              there exists a path S ⇝ n                   such thatn →n andS ⇝n
                           ′        J    K                                                                    ′                                                                                         ′′
                     T(nj[PJ/ Pj (v)]). By the definition ofT, ∀v ∈ pts.T(ni) =                                              has been added into the queue. The path S ⇝ n                                 must have
                     T(n′).                                                                                       ■          been popped from the queue since there are finitely many
                           j                                                                                                 paths and no path can be added into the queue twice by
                                                   r    ′             r     ′′                ′            ′′                                                                                                    ′
                      LemmaA.5. ni ⇝ni,T(ni) ⇝ni =⇒ T(ni) =T(ni )                                                            LemmaA.7.Sinceitis popped from the queue,S ⇝ n must
                      Proof. By induction on |r|.                                                                            be placed in the queue by line 8. Now we consider the lines
                      Basis (|r| = 0): n               = n′ and T(n ) = n′′. T(n′) = T(n )                                   10–14. Supposen is not removed from the queue in the lines.
                                                   i         i               i          i         i              i           Then, the lemma trivially holds since n ≈                                 n. Suppose n
                      andT(n′′) = T(T(n′′)). T(T(n′′)) = T(n′′) by Lemma A.3.                                                                                                                    pts
                                   i         ′        i   ′′          i                i                                     is removed frmo the queue in the lines. Then, there exists
                      Therefore,T(ni) =T(ni ).                            ′               ′                                  n′ such that n ≈                 n′. For a similar reason, n′ must have
                      Inductive case: let r = {r} ∪ r where |r | = k for some                                                                           pts
                      k ∈ N andr = A → β.                                                                                    beenplacedintothequeueafterafinitenumberofiterations.
                          Letn′,n′′, tn′ and tn′′ be sentential forms satisfying the                                         Therefore, the lemma holds.                                                                 ■
                                  i    i      i            i
                      following properties:                                                                                  Theorem3.8.Foragivensynthesisproblem,assumingPisfi-
                                                           ′                             ′
                                                 r        r                             r                                    nite, weighted_search generates a sequence of candidate
                                           ni →n′ ⇝n′                        T(n′) ⇝ tn′                                                                            e
                                                      i         i                  i            i                            programs satisfying the prioritization, partial correctness,
                                                             ′                           ′
                                                  r     ′′  r      ′′             ′′    r   t   ′′                           andpartial completeness properties.
                                       T(ni) →ni ⇝ni                        T(ni ) ⇝ ni                                      (Stated in Section 3.3.)
                                                              ∗                                ∗               ′
                      Letni = sAu wheres ∈ Σ ,A ∈ N,u ∈ (N ∪ Σ) . Then,ni =
                      sβu andT(ni) = T(s) A T(u). Also, n′′ = T(s) β T(u) and                                                Proof. (1) Prioritization: Without lines 10–14 in Algo. 2, the
                                                                                  i
                     T(n′) = T(sβu). Since T(n′′) = T(T(s) β T(u)), by Lemma                                                 prioritization property holds because of Theorem 3.3. The
                           i                                    i                                                            optimization part from line 10 to line 14 does not affect
                      A.3, T(n′) = T(n′′). By the induction hypothesis T(n′) =
                                   i             i                                                           i               the distance values in the priority queue but only removes
                         t   ′               ′′         t   ′′                      ′            ′′       t   ′
                     T( ni) andT(ni ) =T( ni ). BecauseT(ni) =T(ni ),T( ni) =                                                someelements in the queue. Therefore, it does not harm the
                         t   ′′                          ′            ′′
                     T( ni ). Therefore,T(ni) =T(ni ).                                                            ■          prioritization property.
                      Lemma A.6. ∀v ∈ pts. T(n [v/x]) = T(n [v/x])                                            =⇒                 (2) Correctness: trivially true by line 4 in Algo. 2.
                                                                      i                       j                                  (3) Completeness: Let P ∈ P a solution. Since P is finite,
                      n ∼        n .
                        i    pts    j                                                                                        Gˆ isalso finite. By the definition of the graph Gˆ , every
                                                                                                r                r              Gq                                                                           Gq
                      Proof. Let Pi,Pj ∈ P are programs such thatni ⇝ Pi ∧nj ⇝                                               sentential form that can be derived from S is reachable from
                      Pj. Then                                                                                               S. Therefore, P is reachable from S. By Lemma A.8, after a
                                                          r                                  r                               finite number of iterations, P′ ∈ P such that P ≈                                   P′ will
                            ∀v ∈ pts. n [v/x] ⇝ P [v/x] ∧n [v/x] ⇝ P [v/x].                                                                                                                                pts
                                              i                 i               j                  j                         be placed into the queue. By Theorem 3.7, P ∼                                       P′ and
                                                                                                                 r                                                                                         pts
                              ′    ′                                                                                                                    ′                                 J ′K
                      Let Pi,Pj are programs such that ∀v ∈ pts. T(ni[v/x]) ⇝                                                Algo. 2 returns P at line 5. If ∀x. Φ(x, P                          (x)), the solution
                        ′                             r     ′                                                                is found. Otherwise, a counter-example cex will be added
                      Pi andT(nj[v/x]) ⇝ Pj. Because ∀v ∈ pts. T(ni[v/x]) =                                                  into pts (line 8 in Algo. 1), and Algo 2 runs again. Notice
                     T(nj[v/x]), P′ = P′. By Lemma A.5,T(Pi[v/x]) =T(P′) and                                                           ′
                                          i      ′j               ′       ′                               i                  that P cannot be generated by Algo. 2 again, since it will
                     T(Pj[v/x]) =T(Pj). Since Pi = Pj,T(Pi[v/x]) =T(Pj[v/x]).                                                never be consistent with cex. In this manner, at least one
                                                        J    K          J    K
                      Therefore, ∀v ∈ pts. Pi (v) = Pj (v).                                                       ■          program is excluded from the search space P, which is finite.
                      LemmaA.7. InAlgo.2,nopathcanbeaddedintothequeue                                                        Therefore, after finitely many steps, Algo. 2 eventually finds
                                                                                                                                ′′                                    ′′                      J ′′K
                                                                                                                             P ∈PsuchthatP ∼                        P and∀x.Φ(x, P                     (x)).             ■
                      twice.                                                                                                                                   pts
