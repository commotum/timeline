                                                    Recursive                                              CoT                                          Semi-Recursive
                               3.0                                                 3.0
                                                                                                                                       4.0
                               2.5                                                 2.5
                                                                                                                                       3.5
                               2.0                                                 2.0
                                                                                                                                       3.0
                               1.5                                                 1.5
                                                                                                                                       2.5
                              Loss (Val)1.0                                        1.0
                                                                                                                                       2.0
                               0.5                                                 0.5
                                                                                   0.0                                                 1.5
                               0.0
                                   0     20    40     60    80    100   120    140     0     20    40    60     80    100   120    140    0     20     40    60     80    100   120   140
                                                       Epoch                                               Epoch                                               Epoch
                                          RoPE                  Resonance RoPE (Ours)                          YaRN (s=4)                     Resonance YaRN (s=4) (Ours)
                          Figure 3: The validation loss curves of Transformers using RoPE and YaRN PEs with and without our RESONANCE
                          scaling on the three subtasks of POSGEN.
                                  Setting            Recursive             CoT           Semi-Rec.             in OODscenarios. This improvement indicates a
                                    RoPE             65.29±0.43        69.56±0.33        17.96±0.03            superior adaptation to OOD position embeddings
                             Res. RoPE (Ours)        62.64±0.15        75.25±0.10        29.78±0.07            through minimized Positional Encoding (PE) in-
                                    YaRN             95.93±0.04        98.71±0.00        33.70±0.04            terpolation. An exception is observed when apply-
                             Res. YaRN(Ours)         98.30±0.00        99.58±0.00        48.46±0.03            ing RESONANCE ROPE totheRecursivesubtask,
                                                                                                               likely due to the dominance of extrapolated post-
                          Table 1: The accuracy on OOD Positions (OOD Acc.)                                    critical dimensions in OOD positions. This issue
                          on POSGEN’s test set. All results are in percentage (%).                             canbemitigatedbyemployingaRoPEscalingtech-
                          Wereportboththemeanandvarianceacrossfive runs                                        nique such as YaRN, which effectively counters the
                          with different random seeds. We compare the same                                     extrapolation of post-critical dimensions. Among
                          RoPE-based PE with or without our RESONANCE scal-                                    all configurations, RESONANCE YARN exhibits
                          ing. The best performance for each pair of settings on                               the highest OOD performance, demonstrating the
                          each subtask is marked in Bold.
                                                          P                                                    synergy between RoPE scaling methods and the
                          h(x ,x ,x ,x ) =                    3     x mod17withvocab-
                                0     1     2    3            i=0 i                                            Resonance technique.
                          ulary V = {0,...,16}.                                                                    Figure 3 plots validation losses against training
                              Our experiments involved training a two-layer                                    epochs for different PEs, illustrating the training
                          Transformer. Each layer follows T5-Small’s config-                                   dynamics. The introduction of the Resonance tech-
                          urations (Raffel et al., 2020) except for the position                               nique leads to a reduction in the lowest validation
                          embeddings. In this model, each attention head has                                   loss for both RoPE and YaRN, with RESONANCE
                          64dimensions. WeapplydifferentRoPE-basedem-                                          ROPEachievingevenlowervalidation losses than
                          beddings with the rotary base equal to 10,000. The                                   YaRNintheSemi-Recursivesubtask. Furthermore,
                          models are trained on sequences of length L = 64,                                    the validation loss trajectories for RESONANCE
                          and evaluating on lengths of L′ = 256 for OOD                                        ROPEandRESONANCEYARNremainlowerthan
                          Accuracy. In this experiment setting, each head has                                  those of their counterparts in all subtasks, further
                          32RoPEfeatures, out of which the first 17 are pre-                                   demonstrating the enhanced OOD generalization
                          critical dimensions with a wavelength less than the                                  capability of our approach.
                          maximum training length. We generated 10,000
                          training sequences, and 1,000 each for validation                                    6.2      LLMFine-tuningEvaluation
                          and testing, and ensured that the first j + k = 4                                    6.2.1       ExperimentSetup
                          tokens in each sequence do not overlap to testify
                          whether the model learns the correct generation                                      In this section, we apply our proposed RESO-
                          mechanism. We averaged results over 5 seeds. A                                       NANCE ROPEtothecurrentstate-of-the-art RoPE
                          moredetailed setting is provided in Appendix C.1.                                    scaling method, YaRN (Peng et al., 2024). More
                                                                                                               specifically, we replace the original position em-
                          6.1.2       Results and Analysis                                                     beddings of LLaMA2 7B and 13B (Touvron et al.,
                          Table 1 displays the comparison of the OOD accu-                                     2023b)withaseriesofscaledpositionembeddings,
                          racy. In most cases, RESONANCE ROPE and RES-                                         including the NTK-Aware scaling (bloc97, 2023;
                          ONANCE YARN outperform their counterparts                                            Xiongetal.,2023;Liuetal.,2024),DynamicNTK-
                          lacking the Resonance technique, showcasing sig-                                     Aware Scaling (Peng et al., 2024; Rozière et al.,
                          nificantly better performance and reduced variance                                   2023), and YaRN (Peng et al., 2024).
                                                                                                          592
