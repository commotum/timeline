                   Accelerating Program Synthesis using Learned Probabilistic Models                                        PLDI’18, June 18–22, 2018, Philadelphia, PA, USA
                   for PHOGs following the previous work [6]. The details can                                         Start symbol        S    → NZ
                                                                                                                     Bitvector expr      N     → Var |Const | N BopN
                   be found in Appendix.                                                                                                  Z              Z        Z    Z       Z
                       In guiding the search for a solution of a newly given syn-                                                               |    −NZ | Ite NB NZ NZ
                                                                                                                         Binary op      Bop    → +|−|&| ∥ |× |/|<< | >> | mod
                                                                                                                   Bitvector param     Var     → param | ··· | param
                   thesis problem, we use the learned pivot PHOG for a statisti-                                    Bitvector const  ConstZ    → ··· 1                    n
                   cal model. Recall that a statistical program model G is used                                       Boolean expr      NZ     → true | false
                                                                                          q                                               B
                   in the weighted search algorithm as described in Section 3.                                                                  |    NZ = NZ | NB ∧ NB | NB ∨ NB | ¬NB
                   Weuse a statistical model Gq = ⟨G,C,p,q⟩ derived from                                             Figure 4. The grammar for the bitvector domain.
                                                ˆ#                             ∗
                   the pivot grammarG whereC ⊆ (N ∪Σ) andq assigns a
                   probability for each next possible production A → β ∈ R
                   given a current sentential form s as follow:
                                                            #                                                          Start symbol        S    → D1
                           q(A → β | p(s)) = η ×q (A[α∆(p(s))] → αΣ(β)).                                            Gates at depth 1     D1     → D2∧D2 |D2∨D2 |D2 ⊕D2 |¬D2
                                                                                                                    Gates at depth 2     D2     → D3∧D3 |D3∨D3 |D3 ⊕D3 |¬D3
                   whereη ∈ [0,1] is a coefÏcient for making the sum of the                                                                     · · ·
                   probabilities 1. The rules instantiated from the same fea-                                       Gates at depth n     Dn     → VarB
                                                                                                                     Boolean param     VarB     → param | ··· | param
                   tured rule are assigned the same probability. This probability                                                                            1              n
                   assignmentisformakingprogramsentencesequivalentmod-                                                 Figure 5. The grammar for the circuit domain.
                   ulo the feature map equally likely.
                   4.3     Instances                                                                                 Start symbol         S    → N |N |N
                                                                                                                                                       S    Z     B
                                                                                                                       String expr      N      → Var |Const | ConCat(N , N )
                   Wenext describe three instances of feature maps used in                                                                S             S        S             S   S
                   our experiments. Similar to recent synthesis works that use                                                                  |    Rep(NS, NS, NS) | StrAt(NS, NZ)
                                                                                                                                                |    SubStr(NS, NZ, NZ) | IntToStr(NZ)
                   manually designed abstract semantics [33], domain-specific                                                                   |    IteNB NS NS
                   languages [5], or clues [21], designing a pivot grammar for a                                     String param     VarS     → ···
                                                                                                                      String const  ConstS     → ···
                   newsynthesis task needs domain knowledge. We conjecture                                            Integer expr      NZ     → VarZ | ConstZ | NZ +NZ | NZ −NZ
                   that the principle behind our feature maps can be reused for                                                                 |    Length(NS) | StrToInt(NS)
                                                                                                                                                |    StrPos(NS, NS, NZ)
                   other synthesis tasks. For example, the feature maps for the                                     Integer param     VarS     → ···
                   bit-vector and circuit tasks share the same idea that is also a                                   Integer const  ConstZ     → ···
                                                                                                                     Boolean expr       NB     → VarB | true | false | NZ = NZ
                   part of the pivot grammar for the string tasks.                                                                              |    PrefixOf(NS, NS) | SuffixOf(NS, NS)
                                                                                                                                                |    Contains(NS, NS)
                   Bit-vector manipulation tasks. Figure 4 shows the gram-                                         Boolean param      VarB     → ···
                   mar used in our bit-vector manipulation tasks. Parameter                                             Figure 6. The grammar for the string domain.
                   variables can have bit-vector values. We transform terminal
                   symbols corresponding to parameter variables into a single                                  dealing with string constants in the context of the input-
                   feature terminal symbol param . This transformation en-
                                                                ⋆                                              output specification to avoid overfitting. Let Φ be a specifica-
                   ables PHOGs to capture the features for various solutions                                   tion which is a set of input-output examples and I and O be
                   that have a different number of parameter variables. Let V                                  string constants appearing in the input and output examples,
                   be the set of all possible names for parameters. We define
                   the feature map as follows:                                                                respectively. We define the following sets of strings.
                      Σ# = Σ\V∪{param },               αΣ(s) =       param⋆        (s ∈ V)
                                               ⋆                     s             (otherwise)                  SIO = {s∈S | ∃s′∈I ∩O.s ⪯ s′}                SI = {s∈S | ∃s′∈I. s ⪯ s′}
                                                                                                                S ={s∈S|s′∈I ∪O.s ⪯s′} S = {s∈S | ∃s′∈O.s ⪯s′}
                   Circuitmanipulationtasks. Figure5showsthegrammar                                               ⊥                                           O
                   used in our benchmarks in the circuit manipulation tasks.                                   where S is the set of all strings and ⪯ is the subsequence
                   Weusedasimilartransformation as the one used for the bit-                                   relation. We represent constant strings using four symbols
                   vector domain, i.e., we merge boolean parameter variables                                   const ,const ,const andconst todenotestringsbe-
                   into the featured terminal symbol param .                                                           IO            I          O                 ⊥
                                                                            ⋆                                  longing to the above four sets, respectively.
                   String manipulation tasks. Figure 6 shows the grammar                                          Puttingitall together, we define the abstraction as follows:
                   used in our benchmarks in the string domain. Parameter                                                           Ð
                   variables can have either of string, integer, or boolean values.                                 Σ#    = Σ\(                    V )∪{param | ⋄ ∈ {S,Z,B}}
                   Wetransform terminal symbols corresponding to parame-                                                            Ð⋄∈{S,Z,B} ⋄                    ⋄
                   ter variables to handle solutions having different parameter                                                   \(   ⋄∈{IO,I,O,⊥} S⋄) ∪ {const⋄ | ⋄ ∈ {IO,I,O,⊥}}
                                                                                                                                 param         (s ∈ V ,⋄ ∈ {S,Z,B})
                                                                                                                                          ⋄            ⋄
                   variables. Let V ,V and V be the set of all possible names                                                   
                                         S    Z          B                                                      α (s)     =         const       (s ∈ S ,⋄ ∈ {IO,I,O,⊥})
                   of parameter variables of string, integer, and boolean types.                                  Σ                       ⋄            ⋄
                                                                                                                                 s             (otherwise).
                   In addition, we also transform terminal symbols of string                                                    
                   constants. As shown in Section 2, this transformation is for
