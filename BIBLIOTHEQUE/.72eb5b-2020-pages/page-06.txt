                   227:6                                                                                    Shraddha Barke, Hila Peleg, and Nadia Polikarpova
                    Size   #Programs                                                                     Bank
                      1          4                                                                 arg, "", "<", ">"
                      2          0                                                                        None
                      3          9                                     (concat arg arg), (concat arg "<"), (concat arg ">"), (concat "<" arg),
                                                               (concat "<" "<"), (concat "<" ">"), (concat ">" arg), (concat ">" "<"), (concat ">" ">")
                      4          6                                     (replace arg "<" arg), (replace arg "<" "), (replace arg "<" ">")
                                                                      (replace arg ">" arg), (replace arg ">" ""), (replace arg ">" "<")
                      .          .                                                                         .
                      .          .                                                                         .
                      .          .                                                                         .
                      8        349                   (concat (concat (replace arg "<" arg) arg) arg), (concat (replace arg ">" (concat ">" arg)) ">"),
                                                    (replace (concat arg "<") (concat ">" "<") "") ... (replace (concat ">" arg) (concat ">" "<") ">")
                      9        714        (concat (concat arg arg) (concat (concat arg arg) arg)), (concat (concat "<" "<") (concat (concat ">" "<") "<")), ...
                                                 (replace (replace arg "<" "") "<" (concat ">" ">")), (replace (replace arg ">" (concat ">" ">")) "<" ">")
                     10        2048                                         (concat "<" (replace (concat arg arg) (concat ">" arg) "<")),
                                                                           . . . (concat arg (concat (replace arg "<" (concat ">" ">")) ">"))
                      Fig. 7. Programs generated for remove-angles-short from the grammar in Fig. 4 in the order of size.
                   combinations of programs from the bank as subexpressions, even a small reduction in bank size at
                   lower heights leads to a significant overall speed-up.
                       Despite this optimization, the size of the bank grows extremely quickly with height, as illustrated
                   in Fig. 6. In order to get to the desired program replace-3, which has height three, we need
                   to enumerate anywhere between 1024 and ‚àº 30Ì†µÌ±Ä programs (depending on the order in which
                   productions and subexpressions are explored within a single iteration). Because of this search space
                   explosion, bottom-up enumerative approach does not find replace-3 even after 20 minutes.
                   3 OURAPPROACH
                   In this section, we first modify bottom-up search to enumerate programs in the order of increasing
                   size rather than height (Sec. 3.1) and then generalize it to the order of decreasing likelihood defined by
                   a probabilistic context-free grammar (Sec. 3.2). Finally, we illustrate how the probabilistic grammar
                   can be learned just in time by observing partial solutions during search (Sec. 3.3).
                   3.1      Size-based Bottom-up Enumeration
                   Although exploring smaller programs first is common sense in program synthesis, the exact inter-
                   pretation of ≈Çsmaller≈æ differs from one approach to another. As we discussed in Sec. 2, existing
                   bottom-up synthesizers explore programs in the order of increasing height; at the same time,
                   synthesizers based on other search strategies [Alur et al. 2013, 2017b; Koukoutos et al. 2016] tend
                   to explore programs in the order of increasing size√êi.e. total number of AST nodes√êrather than
                   height, which has been observed empirically to be more efocient.
                       Toillustrate the difference between the two orders, consider a hypothetical size-based bottom-up
                   synthesizer. Fig. 7 shows how the bank would grow with each iteration on our running example.
                   Thesolution replace-3 that we are looking for has size ten (and height three). Hence, size-based
                   enumeration only has to explore up to 2048 programs to discover this solution (compared with up
                   to ‚àº 30Ì†µÌ±Ä for height-based enumeration). This is not surprising: a simple calculation shows that
                   programs of height three range in size from 8 to 26, and our solution is towards the lower end of
                   this range; in other words, replace-3 is tall and skinny rather than short and bushy. This is not a
                   merecoincidence: in fact, prior work [Shah et al. 2018] has observed that useful programs tend to be
                   skinny rather than bushy, and therefore exploration in the order of size has a better inductive bias.
                   Extending bottom-up enumeration. Motivated by this observation, we extend the bottom-up
                   enumerative algorithm from Sec. 2.2 to explore programs in the order of increasing size. To this
                   end, we modify the way subexpressions are selected from the bank in each search iteration. For
                   example,toconstructprogramsofsizefouroftheformconcatÌ†µÌ±• Ì†µÌ±¶,weonlyreplace ‚ü®Ì†µÌ±•,Ì†µÌ±¶‚ü© withpairs
                   of programs whose sizes add up to three (the concat operation itself takes up one AST node). This
                   modest change to the search algorithm yields surprising efociency improvements: our size-based
                   Proc. ACMProgram. Lang., Vol. 4, No. OOPSLA, Article 227. Publication date: November 2020.
