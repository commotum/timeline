                                          Vt[i] =  Vt−1[i]      if 1 ≤ i < t        (Note that Vt[i] = vi for all i ≤ t)          (1)
                                                      vt         if i = t
                                                                                        t−1
                                                   max(0,s        [i] − max(0,u − P s             [j]))   if 1 ≤ i < t
                                          st[i] =              t−1                t   j=i+1 t−1                                   (2)
                                                      dt                                                   if i = t
                                                 t                              t
                                          rt = X(min(st[i],max(0,1− X st[j])))·Vt[i]                                               (3)
                                                i=1                           j=i+1
                             Formally, a Neural Stack, fully parametrised by an embedding size m, is described at some timestep
                             t by a t × m value matrix Vt and a strength vector st ∈ Rt. These form the core of a recurrent layer
                             whichis acted upon by a controller by receiving, from the controller, a value vt ∈ Rm, a pop signal
                             u ∈(0,1), and a push signal d ∈ (0,1). It outputs a read vector r ∈ Rm. The recurrence of this
                               t                               t                                     t
                             layer comes from the fact that it will receive as previous state of the stack the pair (V    , s   ), and
                                                                                                                      t−1   t−1
                             produceasnextstatethepair(Vt,st)followingthedynamicsdescribedbelow. Here,Vt[i]represents
                             the ith row (an m-dimensional vector) of Vt and st[i] represents the ith value of st.
                             Equation 1 shows the update of the value component of the recurrent layer state represented as a
                             matrix, the number of rows of which grows with time, maintaining a record of the values pushed to
                             the stack at each timestep (whether or not they are still logically on the stack). Values are appended
                             to the bottom of the matrix (top of the stack) and never changed.
                             Equation 2 shows the effect of the push and pop signal in updating the strength vector st−1 to
                             produce st. First, the pop operation removes objects from the stack. We can think of the pop value
                             u as the initial deletion quantity for the operation. We traverse the strength vector s         from the
                               t                                                                                        t−1
                             highest index to the lowest. If the next strength scalar is less than the remaining deletion quantity, it
                             is subtracted from the remaining quantity and its value is set to 0. If the remaining deletion quantity
                             is less than the next strength scalar, the remaining deletion quantity is subtracted from that scalar and
                             deletion stops. Next, the push value is set as the strength for the value added in the current timestep.
                             Equation 3 shows the dynamics of the read operation, which are similar to the pop operation. A
                             ﬁxed initial read quantity of 1 is set at the top of a temporary copy of the strength vector s which
                                                                                                                              t
                             is traversed from the highest index to the lowest. If the next strength scalar is smaller than the
                             remaining read quantity, its value is preserved for this operation and subtracted from the remaining
                             read quantity. If not, it is temporarily set to the remaining read quantity, and the strength scalars of
                             all lower indices are temporarily set to 0. The output rt of the read operation is the weighted sum
                             of the rows of Vt, scaled by the temporary scalar values created during the traversal. An example
                             of the stack read calculations across three timesteps, after pushes and pops as described above, is
                             illustrated in Figure 1a. The third step shows how setting the strength s3[2] to 0 for V3[2] logically
                             removes v2 from the stack, and how it is ignored during the read.
                             This completes the description of the forward dynamics of a neural Stack, cast as a recurrent layer,
                                                                                                                     1
                             as illustrated in Figure 1b. All operations described in this section are differentiable . The equations
                             describing the backwards dynamics are provided in Appendix A of the supplementary materials.
                             3.2   Neural Queue
                             Aneural Queue operates the same way as a neural Stack, with the exception that the pop operation
                             reads the lowest index of the strength vector st, rather than the highest. This represents popping and
                             reading from the front of the Queue rather than the top of the stack. These operations are described
                             in Equations 4–5.
                                                                                        i−1
                                                    max(0,s         [i] − max(0,u − P s          [j]))  if 1 ≤ i < t
                                           st[i] =              t−1                t    j=1 t−1                                   (4)
                                                       dt                                                if i = t
                                1The max(x,y) and min(x,y) functions are technically not differentiable for x = y. Following the work
                             onrectiﬁed linear units [16], we arbitrarily take the partial differentiation of the left argument in these cases.
                                                                                 3
