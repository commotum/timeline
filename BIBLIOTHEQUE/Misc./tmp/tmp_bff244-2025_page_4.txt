                         F            å µí°¶         3D position     F            E         Edge endpoints                 Candidate edge  Edge endpoint   Reference point  Sampling location
                                        å µí±–+1                                    å µí±–+1
                                              MLP
                                 Add & Norm                               Add & Norm
                                 Feed Forward                            Feed Forward
                                 Add & Norm                               Add & Norm                          (a) Height Map / Wireframe   (b) Vanilla Deform. Attn.  (c) Edge Attention (Ours)
                                Cross-Attention                           Edge Attention                      Figure4. EdgeAttention. (a)Theheightmapandthecorrespond-
                                            Ref.                                    Ref.
                                  Add & Norm                              Add & Norm                          ing ground-truth wireframe (top view). (b) Vanilla deformable at-
                                 Self-Attention                          Self-Attention                       tention with only midpoints as reference points. (c) Our proposed
                                                                                                              edge attention with holistic reference points along the edge.
                                                 MLP                                  MLP Uniform 
                                                                                            Sampling          as depicted in Figure 4.
                                                                 F             E                                  Taking the sparse and incomplete characteristics of air-
                         F             å µí°¶        3D position                         Edge endpoints
                                                                                 å µí±–
                                        å µí±–                                                                    borne LiDAR point clouds into consideration, it is neces-
                     (a) Decoder layer in 3D corner model        (b) Decoder layer in edge model
                                                                                                              sary to pay attention to the whole edge and extract local
                     Figure 3. Illustration of Transformer decoders. Details of the                           details from different positions. To this end, we propose
                     decoder layer in the 3D corner model (a) and the edge model (b).                         the edge attention mechanism to enhance the holistic per-
                                                                                                              ception of edges. We uniformly sample M reference points
                     two dimensions of corner queries are initialized with them                               along an edge with the sampling point set S represented
                                                                                                              as {s }M , where s                indicates the m-th sampled point.
                     while the height dimension is randomly initialized. In the                                      m m=1                   m
                     decoder, the self-attention layer enables information shar-                              Then, the edge content queries are replicated M times and
                     ing between queries first. Then in the deformable cross-                                 focus on the corresponding areas to the sampled points. In
                     attention layer, reference points are the 2D positions and                               the end, a max-pooling operation is performed to aggregate
                     queries interact with the image features. Finally, height off-                           information from all positions.
                     sets and corner labels are predicted by two separate MLPs                                    Givenamulti-scalefeaturemapF outputtedbytheback-
                                                                                                              bone, an edge query q âˆˆ RC, and the sampled point set S,
                     using the content queries, and 3D corners are obtained with                              the Edge Attention (EA) is calculated by:
                     the corner label predicted as valid.
                                                                                                                EA(q,S,F) = MaxPool(MDA(q,s ,F))|s âˆˆ S), (1)
                     3.3. Edge Detection                                                                                                                          m           m
                     Edge Transformer. With 3D corners predicted, we cast                                     where MaxPool is the max-pooling operation and MDA is
                     the edge detection task as a binary classification problem to                            the vanilla multi-head deformable attention. With the pro-
                     label connections between two corners as valid or not.                                   posed edge attention, the edge feature is extracted holisti-
                         AsshowninFigure3(b),werepresentedgequerieswith                                       cally while the local details are also preserved.
                     bothedgecontentqueriesandedgepositionalqueries. Edge                                     3.4. Loss Functions
                     content queries are represented with the edge features ex-                               Bipartite Matching. For 3D corners, we perform bipartite
                     tracted by the image feature fusion module proposed in                                   matching between the predicted and the ground-truth ones
                     HEAT [3] which injects the image features into the edge                                  according to the corner L distance and corner labels. The
                     with deformable attention [39]. Edge positional queries in-                                                                 1
                     dicate the space position of the edges. The sinusoidal po-                               matching cost C is defined as:
                                                                                                                                  N
                     sitional embeddings of the edge endpoints are calculated.                                                      gt
                                                                                                                          C=X(d (c,c )+L (c,c )),                                          (2)
                     With an MLP network, the positional queries are obtained.                                                            L     i   Ïƒ(i)         ce   i   Ïƒ(i)
                                                                                                                                           1
                         In the decoder layer, through the interaction of self-                                                   i=1
                     attention and edge attention, the final probabilities of the                             where Ngt is the number of ground truth corners, ci and
                     edges are predicted by an MLP from edge queries. With                                    cÏƒ(i) are the ground-truth corners and the matched corner
                     valid edges, the building wireframe is reconstructed.                                    predictionsrespectively, d             (Â·, Â·) is the L distance between
                     Edge Attention. Due to the sparsity, incompleteness, and                                                                    L1                   1
                     noise of the airborne LiDAR point clouds, it is challenging                              the two corners, and Lce(Â·,Â·) is the binary cross-entropy be-
                                                                                                              tween the probabilities of two corners. An optimal match-
                     to determine whether a line connecting two corners is an                                 ing is determined by minimizing the above matching cost.
                     edge or not. For vanilla deformable attention [39] in edge                               Total Loss. We train our BWFormer model in an end-to-
                     detection, the reference points are placed at the midpoints                              end manner, where the total loss is defined as:
                     of edges, attending to only areas near the midpoints. How-                                                  L=Î» L            +Î» L           +Î» L ,                    (3)
                                                                                                                                         1 c           2 c            3 e
                     ever, it may fall short of a holistic understanding of edges                                                             2D             3D
                                                                                                      22218
