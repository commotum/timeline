                                     Published as a conference paper at ICLR 2024
                                       Metadata
                                                                                                           Test Patch
                                       Repo                                     Issue #s     [14858]
                                                   scikit-learn/scikit-learn
                                                                                                            sklearn/ensemble/_hist_gradient_boosting/tests/test_gradient_boosting.py
                                       Instance ID                              Pull Number  14869
                                                   scikit-learn__scikit-learn-14869
                                                                                                            418     assert stump_clf.fit(X, y_isnan).score(X, y_isnan) == 1

                                       Created At Aug 31, 2019                  Base Commit 1018f9f...
                                                                                                            419

                                                                                                            420 + def test_crossentropy_binary_problem():

                                                                                                            421 +   # categorical_crossentropy should only be used if there

                                       Problem Statement
                                                                                                            422 +   # are more than two classes present. PR #14869

                                                                                                            423 +   X = [[1], [0]]

                                       HGBC with categorical_crossentropy fails silently on binary classification
                                                                                                            424 +   y = [0, 1]

                                                                                                            425 +   gbrt = HistGradientBoostingClassifier(loss='categorical_crossentropy')

                                         import numpy as np

                                                                                                            426 +   with pytest.raises(ValueError, match="'crossentropy' not suitable"):

                                         from sklearn.experimental import enable_hist_gradient_boosting

                                                                                                            427 +     gbrt.fit(X, y)

                                         from sklearn.ensemble import HistGradientBoostingClassifie
|
                                                                                                            428 

                                                                                                            429   @pytest.mark.parametrize("scoring", [None, 'loss'])
                                         X = [[1, 0], [1, 0], [1, 0], [0, 1], [1, 1]]

                                         y = [1, 1, 1, 0, 1]

                                         gb = HistGradientBoostingClassifier(loss='categorical_crossentropy',

                                                                             min_samples_leaf=1)

                                                                                                           Gold Patch
                                         gb.fit(X, y)

                                         print(gb.predict([[1, 0]]))

                                                                                                            sklearn/ensemble/_hist_gradient_boosting/gradient_boosting.py
                                         print(gb.predict([[0, 1]]))
                                                                                                            1041   def _get_loss(self): 
                                       gives:                                                               1042 +   if (self.loss == 'categorical_crossentropy' and 
                                                                                                            1043 +     self.n_trees_per_iteration_ == 1): 
                                                                                                            1044 +     raise ValueError("'categorical_crossentropy' is not suitable for " 
                                         [0]

                                                                                                            1045 +                      "a binary classification problem. Please use " 
                                         [0]
                                                                                                            1046 +                      "'auto' or 'binary_crossentropy' instead.") 
                                                                                                            1047 + 
                                       And binary_crossentropy works fine. categorical_crossentropy 

                                                                                                            1048     if self.loss == 'auto':

                                       should either generalize or raise an error on binary classification.
                                                                                                            1049       if self.n_trees_per_iteration_ == 1: 
                                                                                                            1050         return _LOSSES['binary_crossentropy']()
                                       Ping @NicolasHug @ogrisel
                                     Figure 7: SWE-bench task instance example. Problem statement P is an aggregation of the issues
                                     related to the pull request. Codebase C corresponds to a repository and base commit. The tests T
                                     and solution D are derived from the original PR’s associated code changes. Stylized for readability.
                                     A.2      CONSTRUCTION PROCESS
                                     Wediscuss additional details regarding the conversion of a pull request object into a candidate task
                                     instance. At a high level, the main goal of this conversion is to acquire relevant information for
                                     putting together the codebase C, problem statement P, unit tests T, and solution δ components
                                     introduced in Section 2. To this end, a SWE-bench task instance consists of the following fields,
                                     presented in the following Table 9. Collectively, the fields correspond to the four task instance
                                     modules.
                                         Field                                  Description
                                         base commit                            (str) The commit ID that the original PR is applied on top of
                                         created at                             (date) Datetime object of when PR was first created (not merged)
                                         hints text                             (str) Natural language suggestions for how to solve problem
                                         instance id                            (str) A unique identifier created from repo and pull number
                                         issue numbers                          (list) List of issue numbers that the original pull request resolves
                                         patch                                  (str) .patch-format styled string that is a reference solution
                                                                                to the problem, extracted from the original PR’s code changes
                                         problem statement                      (str) Natural language description of desired change to codebase
                                         pull number                            (int) The pull number of the original pull request
                                         test patch                             (str) .patch-format styled string containing unseen tests
                                                                                for checking if a task was solved, extracted from the original
                                                                                PR’s code changes
                                         version                                (str) Release version (w.r.t. repo) during which PR was created
                                         repo                                   (str) The repository the task instance originates from
                                         FAIL TO PASS                           (list) List of tests that change in status from fail to pass
                                         PASS TO PASS                           (list) List of tests that change in status from pass to pass
                                         env install commit                     (str) Base commit at which to install necessary
                                                                                dependencies for running task instance.
                                     Table 9: Description of each field of a SWE-bench task instance object. See § A.2 for details
                                     regarding how each field is collected.
                                     Problem Statement. The problem statement P for each task instance is readily available as the
                                     problem statementfield. The problem statement is an aggregate of all issues’ first comments
                                     along with any comments attached to those issues that were created before the creation date of
                                     the PR’s initial commit. We crawl for issues from PR’s title, body, and commit messages. After
                                                                                                      16
