                                                              8       PPL When Modifying Different Layers                                                            5.0   Effective Interpolation Ratio Across Layers
                                                                                                                                                                                                                            r=5, =1.3
                                                              7                                                                                                     atio4.5                                                 r=4, =1.3
                                                                                                                                                                                                                            r=5, =1
                                                              6                                                                                                                                                             r=4, =1
                                                                                                                 r=4,  =1                                            4.0
                                                              5                                                  r=5,  =1.3
                                                                                                                 Original (8K)                                       3.5
                                                            ogarithmic PPL4                                      Original (2K)
                                                            L
                                                              3                                                                                                     Effective Interpolation R3.0
                                                              2                                                                                                      2.5
                                                                           4     6    8    10    12   14    16    18   20    22   24                                        4     6      8    10     12    14     16    18     20    22     24
                                                                                              Layer                                                                                                    Layer
                                                     Figure 8: Changes of PPL with replacement                                                                Figure 9: Effective scaling factors of posi-
                                                     at different layers.                                                                                     tional vectors at each layer.
                                                     we compute the averaged first element of each hidden state after attention in the first layer and
                                                     head, which represents the positional vectors at that position for both NoPE and RoPE. As shown in
                                                     Figure 7, the first element of the output increases fast at initial positions. Here, we can observe that
                                                     the attention preferences make the first element of the output increase fast at the initial positions and
                                                     tend to stabilize at a later position, further proving the different positional vectors of following tokens
                                                     from the initial ones.
                                                     In summary, Transformers with either NoPE or RoPE can learn preference in attention score. In
                                                     addition, the preference in attention scores forces the different positional vectors of the subsequent
                                                     tokens with the initial tokens.
                                                     C DefinationofEffective Interpolation Ratio
                                                     Given a Transformer with a context window size C. For samples with length C′(C′ > C), we disen-
                                                     tangle positional vectors {p                                , . . . , p        ′}. Subsequently, we employ a context window extension
                                                                                                             l,1               l,C
                                                     method and re-compute the position vectors {p′l,1,...,p′l,C′}. We first define the corresponding
                                                     position indices f(p′l,t) for positional vector after extension p′l,t) as the indices of the most similar
                                                     positional vectors before extension:
                                                                                                                                                                       T      ′
                                                                                                                                                                    p p
                                                                                                                   f(p′ ) = arg max                                    l,i    l,t       .                                                      (13)
                                                                                                                            l,t                 1≤i≤C′                           ′
                                                                                                                                                               ∥p ∥∥p ∥
                                                                                                                                                                     l,i         l,t
                                                     Then, the effective interpolation ratio r′ can be represented as the ratio between the maximum indices
                                                     of position vectors after extension whose corresponding position indices are the context window size
                                                     C,asshowninEquation14.
                                                                                                                                                         ′          ′
                                                                                                                            argmax                        (f(p            ) = C)
                                                                                                                  r =                       1≤t≤C                     l,t               .                                                      (14)
                                                                                                                                                        C
                                                     D AnalysisofPositional Vector Replacement
                                                     D.1         OptimalReplacementLayer
                                                     Replacing positional vectors for all layers requires heavy recalculation efforts, so we only select
                                                     one critical layer to apply the replacement strategy. We evaluate the performance (logarithmic PPL
                                                     score) of our replacement strategy at each layer in TL-NoPE, using different interpolation ratios
                                                     and expansion factors, i.e.,(r = 4,α = 1) and (r = 5,α = 1.2), on samples with 8K tokens from
                                                     RedPajama. As shown in Figure 8, the PPL is the lowest when replacing the 4-th layer of TL-NoPE.
                                                     Thus, we choose the 4-th layer for replacement in TL-NoPE in other experiments.
                                                     D.2         Effective Interpolation Ratio
                                                     Wefurther examine the effective interpolation ratio of positional vectors with different settings. In
                                                     our setting, we only replace the positional vectors in the 4-th layer of TL-NoPE with interpolated
                                                                                                                                                    16
