                     13.6.  COMPLEXITY NOT REDUCIBLE TO COMPLEXITIES OF TUPLES            419
                Proof.  Directly from  the definition we can derive the upper  bound  \S\  — 
            0(26n).  Indeed, for every line b there are about 22n lines a in the plane g(b), thus 
            the  cardinality  of S  exceeds  the  number  of lines  (24n)  at  most  22n  times.  This 
            bound  can  also  be  derived  by  counting,  for  every  line  a,  the  number  of lines  b 
            passing through the point /(a).  Notice that in the first argument we did not take 
            into account that b should pass through the point /(a), and in the second argument 
            we did not take into account that the line a should lie on the plane g{b).
                We will modify the first argument as follows.  We used the fact that for every 
            line b there are at most 22n lines a such that the pair (a, b) is in S.  Now we will show 
            that  on average for every line b there are 0(21-5n) lines a such that the pair (a, b) 
            is in S.  To prove this, we will certainly take into account the condition /(a) G b. 
            (We could also modify the second argument and show that on average for every 
            line a the set S has 0(21-5n) pairs of the form (a, *).)
                To this end we partition S into slices.  Each slice is identified by a plane d and 
            consists of all pairs  (a, b)  with g{b) — d.  Thus both lines from all pairs from the 
            same slice lie on the same plane.  We will upper bound the cardinality of each slice, 
            and then we will sum up the obtained bounds.
                Let us fix a plane d and bound the number of pairs in the slice corresponding 
            to d.  To this end fix a point c on the plane d and let Ac denote the set of all lines a 
            on the plane d with /(a) = c.  Similarly, let Bc stand for the set of all lines b passing 
            through c with g(b) — d (the conditions imply that the line a passes through c and 
            the line b lies on d).  It is clear that the cardinality of the slice is at most
                                 EHciibc| < /ei^ei^i2
                                  с               V е          C
            (we have applied the Cauchy-Schwarz inequality).  It is easy to bound both sums in 
            the right-hand side of the displayed inequality, as each of them has a clear meaning. 
            More specifically, the sum Y^c I Ac 12 is proportional to the probability of the follow­
            ing event:  For a randomly chosen (w.r.t. the uniform probability distribution) pair 
            of lines (a', a") on the plane d, it holds that f{a') = f{a").  Indeed, this probability 
            equals the sum over all c of the probability of the intersection of independent events 
            f{a') = c and f{a") — c.  The probability of each of these two events is equal to the 
            ratio of  I Ac I  and the total number of lines on d, which is about 22n.  On the other 
            hand, the probability of event f(a') = /(a") is at most 2~n  (for every fixed a' the 
            probability of event f{a') = f{a") does not exceed the probability that a" passes 
            through the point /(a'), which is about 2~n).  Hence the sum      l^e|2 does not 
            exceed
                                           (22n)2 • 2~n = 23n.
            This inequality holds up to a constant factor.
                The second sum       | Bc |2  is  related  to  the average number of points shared 
            by independent lines 6', b" chosen at random (w.r.t. uniform distribution) from the 
            set  Md  which consists of all lines  b with g(b)  = d (thus all lines from  Md  lie on 
            the plane d).  Indeed,  the average cardinality of intersection of b'  and b"  is equal 
            to  the  sum,  over  all  points  c  G  d,  of probability  of the  event  c  G  b' П b".  This 
            event is the intersection of independent events c G b' and c G b".  The probability 
            of each  of these  events  equals  the  ratio  of  \BC\  and  | Md \ ■  Hence  the  average 
            number of common points in b' and b" is equal to the ratio of the sum   | Bc |2 to 
            the square of  | Add I •  On the other hand,  any two different lines have at most one
