                                                                                                            12.7.  CONDITIONAL CODES FOR TWO  CONDITIONS                                                                                                                                                                                          381
                                            C are good.  If this can be achieved for A and В separately, then some fingerprint 
                                            will be good simultaneously for A and B.
                                                           So we need to change many things, starting from the expander-type property 
                                            we use.  Let E с P x Q be a bipartite graph with left part P and right part Q. 
                                            Now we require that for every small enough U  C  Q, the set of x G  P such that 
                                            most neighbors of x are in U is small.  In other words,  in our previous argument 
                                            a vertex in P was bad for us if all its neighbors are bad in Q\ now it is enough if 
                                            most neighbors are bad in Q.
                                                           Moreover, to adapt our argument to the case when C(C\A) and C(C\B) are 
                                            different, we consider not only fingerprints but also their prefixes.  So the statement 
                                            about the existence of an expander-like graph is now as follows (by [u)m we denote 
                                            the m-bit prefix of и) :
                                                           Lemma.  Let n  and N  be positive integers,  and let e  >  0  be a real number. 
                                            Assume that
                                                                                                                                                                n2N+2n+l£N/2  <   !
                                             Then there exists a family of N mappings
                                                                                                                                                            Xi,...,XN:Bn ^® n
                                            with the following property.  For every m  G {1,... ,n}  and for every non-empty 
                                            subset U C В771  of size at most e2m,  the number of x G ®n  such that
                                                                                                           [Xi(x)]m € U  for at least half of i G {1,..., N} 
                                            is less than \U\  (the cardinality ofU).
                                                           (Some comments:  Instead of a graph with left-degree N, we consider a family 
                                           of N mappings, so we allow multiple edges (xi(x) — Xj(x)  for i ф j).  Now both 
                                           arguments and values of Xi have the same size n, but the statement speaks about 
                                           m-bit prefixes for all m ^ n.)
                                                           Proof.  As usual,  let  us consider randomly chosen Xi> •••■>Xn  (for all i  and 
                                           x the values Xi(x)  are independent and uniformly distributed)  and show that the 
                                           probability of violating the statement is less than  1.  Let us get an upper bound 
                                           for this probability.  For each m ^  n, for each t  < e2m,  and for each pair of sets 
                                           T C l"   and U C Bm both having cardinality t, we consider the following event. 
                                            For each x G T, at least half of the values [Xi{x)\m  (for i — 1,... ,n)  are in U.  We 
                                           need an upper bound for the probability of this event.
                                                          For a fixed iG T  the probability of the event  “at least half of x-neighbors is 
                                           in  U”  is  at  most  2NeN^2:  There are at most  2N  subsets X  C  {1,2,..., AT}  that 
                                           contain at least N/2 elements, and for each X the probability that all Xi(x) axe in 
                                            U (for all i  G  X)  is  at  most eNl2 .  (Recall that  [Xi(x)]m  is uniformly distributed 
                                           in Bm and U occupies only an e-fraction of Bm.)  This event should happen for all 
                                           iG T  (this gives exponent t).  In this way we get the following bound for the total 
                                           probability (that should be less than 1):
                                                                                                                           t i           e2Tn
                                                                                                                       E E  E                                                                                   E  (2We"/2)L
                                                                                                                      77i=l  t= 1  TcBn,|T|=i  UCBm
                                           The number of different T is bounded by 2nt (the number of sequences of t elements 
                                           of Bn).  For the same reason the number of different U is bounded by 2mt.  For the
